<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic Deep Scan üîç</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white p-6 font-mono">

    <h1 class="text-amber-400 text-xl font-bold mb-6">üîç Diagnostic de Connexion Google</h1>

    <div class="space-y-4">
        <button onclick="lancerDiagnostic()" class="w-full bg-blue-600 p-4 rounded-xl font-bold active:scale-95">
            LANCER LE SCAN COMPLET
        </button>
        
        <div id="results" class="bg-black border border-slate-700 p-4 rounded-lg min-h-[300px] overflow-auto text-xs">
            > En attente du scan...
        </div>
    </div>

    <script>
        const KEY = localStorage.getItem('BOITE_KEY_FINAL_2026') || prompt("Entre ta cl√© API :");

        async function log(msg, type = "info") {
            const res = document.getElementById('results');
            const color = { info: "text-blue-300", success: "text-green-400", error: "text-red-400" }[type];
            res.innerHTML += `<div class="${color} mb-1">> ${msg}</div>`;
            res.scrollTop = res.scrollHeight;
        }

        async function lancerDiagnostic() {
            log("D√©marrage du scan...");
            
            // TEST 1 : Format de la cl√©
            if(!KEY.startsWith("AIza")) return log("ERREUR : La cl√© ne semble pas valide (doit commencer par AIza).", "error");
            log("Format de cl√© : OK (AIza...)", "success");

            // TEST 2 : Appel API Direct
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${KEY}`;
            
            log("Envoi d'un signal √† Google...");
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "Coucou" }] }] })
                });

                const data = await response.json();

                if (response.ok) {
                    log("CONNEXION R√âUSSIE !", "success");
                    log("R√©ponse de l'IA : " + data.candidates[0].content.parts[0].text);
                    alert("C'EST BON ! La magie est activ√©e. Tu peux remettre le code de la bo√Æte magique.");
                } else {
                    log("GOOGLE A REFUS√â LA DEMANDE.", "error");
                    log("CODE D'ERREUR : " + response.status, "error");
                    log("MESSAGE : " + data.error.message, "error");
                    log("RAISON : " + data.error.status, "error");
                }
            } catch (e) {
                log("ERREUR R√âSEAU : Impossible de joindre Google.", "error");
            }
        }
    </script>
</body>
</html>