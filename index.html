<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOS Boîte Magique 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #000; color: white; font-family: sans-serif; }
        .btn-test { background: #ef4444; color: white; padding: 20px; border-radius: 15px; width: 100%; font-weight: bold; margin-bottom: 10px; }
        #log { background: #1a1a1a; color: #00ff00; padding: 15px; font-family: monospace; font-size: 11px; border-radius: 10px; min-height: 200px; white-space: pre-wrap; word-break: break-all; }
    </style>
</head>
<body class="p-6">

    <h1 class="text-xl font-bold text-center mb-6 text-amber-500">CONTRÔLE TECHNIQUE</h1>

    <button id="mainBtn" onclick="testerSysteme()" class="btn-test">1. APPUYER ICI</button>

    <div class="mb-4">
        <input type="text" id="promptInput" placeholder="Sujet de l'histoire..." class="w-full p-4 rounded-xl bg-zinc-800 text-white border border-zinc-700">
    </div>

    <div id="log"> > En attente d'un clic sur le bouton...</div>

    <button onclick="localStorage.clear(); location.reload();" class="mt-8 text-zinc-500 text-xs underline block w-full text-center">RÉINITIALISER LA CLÉ API</button>

    <script>
        // On récupère la clé
        let API_KEY = localStorage.getItem('KEY_DIAG_2026');
        if (!API_KEY) {
            API_KEY = prompt("COLLE TA CLÉ API ICI :");
            if (API_KEY) localStorage.setItem('KEY_DIAG_2026', API_KEY);
        }

        function writeLog(msg) {
            const l = document.getElementById('log');
            l.innerHTML += "\n> " + msg;
            console.log(msg);
        }

        async function testerSysteme() {
            const btn = document.getElementById('mainBtn');
            const input = document.getElementById('promptInput').value || "Un petit chat";
            
            // FEEDBACK VISUEL IMMÉDIAT
            btn.style.background = "#22c55e"; // Devient vert
            btn.innerText = "EN COURS...";
            writeLog("Bouton activé ! Début du test.");

            if (!API_KEY) {
                alert("ERREUR : Aucune clé API trouvée.");
                return;
            }

            // TEST DE PLUSIEURS ROUTES GOOGLE
            const model = "gemini-1.5-pro"; // On force le Pro sans suffixe
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${API_KEY}`;

            write